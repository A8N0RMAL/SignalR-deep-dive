
@{
    ViewData["Title"] = "Add Employee";
}

<div class="container mt-5">
    <h2>Add New Employee</h2>

    <form id="employeeForm" class="mt-4">
        <div class="form-group mb-3">
            <label for="employeeName">Employee Name:</label>
            <input type="text" class="form-control" id="employeeName" required>
        </div>

        <div class="form-group mb-3">
            <label for="address">Address:</label>
            <input type="text" class="form-control" id="address" required>
        </div>

        <div class="form-group mb-3">
            <label for="age">Age:</label>
            <input type="number" class="form-control" id="age" required>
        </div>

        <button type="submit" class="btn btn-primary">Add Employee</button>
    </form>

    <div id="message" class="mt-3 alert alert-info" style="display: none;"></div>
</div>

@section Scripts {
    <script src="~/microsoft/signalr/dist/browser/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/employeeHub")
            .build();

        // Start connection
        connection.start().catch(err => console.error(err.toString()));

        // Handle form submission
        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();

                const employee = {
                name: document.getElementById('employeeName').value, // Changed from employeeName to name
                address: document.getElementById('address').value,
                age: parseInt(document.getElementById('age').value)
            };

            // Send employee to server
            connection.invoke("AddEmployee", employee).catch(err => {
                console.error(err.toString());
                showMessage("Error adding employee: " + err.toString(), 'danger');
            });

            // Clear form
            document.getElementById('employeeForm').reset();
            showMessage("Employee added successfully!", 'success');
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `mt-3 alert alert-${type}`;
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
    </script>
}